<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>Virtual Closet Arcade - Inventory System</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Closet Arcade">

    <!-- Modular CSS -->
    <link rel="stylesheet" href="src/css/variables.css">
    <link rel="stylesheet" href="src/css/arcade.css">
    <link rel="stylesheet" href="src/css/components.css">
    <link rel="stylesheet" href="src/css/responsive.css">
</head>
<body>
    <div class="arcade-bg"></div>
    <div class="grid-overlay"></div>
    <div class="crt-overlay"></div>

    <div class="app-container">
        <!-- Retro Header -->
        <header class="retro-header">
            <div class="header-content">
                <h1 class="pixel-text">üéÆ Virtual Closet Arcade üéÆ</h1>
                <div class="score-display">
                    <span class="pixel-small" id="userDisplay"></span>
                    <span class="pixel-small">ITEMS: <span id="totalItems">0</span></span>
                    <span class="pixel-small">VALUE: $<span id="totalValue">0</span></span>
                    <button class="retro-btn-small" id="exportBtn" title="Export Data">üì• EXPORT</button>
                    <button class="retro-btn-small" id="importBtn" title="Import Data">üì§ IMPORT</button>
                    <button class="retro-btn-small" id="backupBtn" title="Backup Manager">üíæ BACKUPS</button>
                    <button class="retro-btn-small" id="headerLogoutBtn" title="Logout">üö™ LOGOUT</button>
                </div>
            </div>
            <div class="level-bar">
                <div class="level-fill" id="levelFill"></div>
            </div>
        </header>

        <!-- Control Panel -->
        <div class="control-panel">
            <input type="text" id="searchInput" class="retro-input" placeholder="üîç SEARCH INVENTORY...">

            <div class="filter-buttons">
                <button class="retro-btn active" data-status="all">ALL</button>
                <button class="retro-btn" data-status="Active">ACTIVE</button>
                <button class="retro-btn" data-status="Inactive">INACTIVE</button>
                <button class="retro-btn" data-status="SOLD">SOLD</button>

                <select id="sortSelect" class="retro-select" style="margin-left: 10px;">
                    <option value="">üîΩ SORT BY</option>
                    <option value="date-desc">üìÖ Newest First</option>
                    <option value="date-asc">üìÖ Oldest First</option>
                    <option value="profit-desc">üí∞ Highest Profit</option>
                    <option value="profit-asc">üí∞ Lowest Profit</option>
                    <option value="name-asc">üî§ A-Z</option>
                    <option value="name-desc">üî§ Z-A</option>
                    <option value="price-desc">üíµ Highest Price</option>
                    <option value="price-asc">üíµ Lowest Price</option>
                </select>
            </div>

            <div class="category-tabs">
                <button class="tab-btn active" data-category="all">ALL TAGS</button>
                <button class="tab-btn" data-category="Hoodie">HOODIE</button>
                <button class="tab-btn" data-category="Jersey">JERSEY</button>
                <button class="tab-btn" data-category="Pullover/Jackets">PULLOVER</button>
                <button class="tab-btn" data-category="polo">POLO</button>
                <button class="tab-btn" data-category="T-shirts">T-SHIRTS</button>
                <button class="tab-btn" data-category="Bottoms">BOTTOMS</button>
            </div>

            <!-- Bulk Operations Panel (hidden by default) -->
            <div id="bulkPanel" style="display: none; margin-top: 10px; padding: 10px; background: rgba(255,0,255,0.1); border: 2px solid var(--retro-pink); border-radius: 5px;">
                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                    <span class="pixel-small" id="bulkSelectedCount">0 SELECTED</span>
                    <button class="retro-btn-small" id="bulkSelectAll">SELECT ALL</button>
                    <button class="retro-btn-small" id="bulkDeselectAll">DESELECT ALL</button>
                    <select id="bulkStatusChange" class="retro-select" style="font-size: 12px; padding: 5px;">
                        <option value="">CHANGE STATUS...</option>
                        <option value="Active">‚Üí ACTIVE</option>
                        <option value="Inactive">‚Üí INACTIVE</option>
                        <option value="SOLD">‚Üí SOLD</option>
                    </select>
                    <button class="retro-btn-small" id="bulkExportSelected" style="background: var(--retro-cyan);">üì• EXPORT</button>
                    <button class="retro-btn-small" id="bulkDeleteSelected" style="background: var(--retro-red);">üóëÔ∏è DELETE</button>
                </div>
            </div>
        </div>

        <!-- Stats Dashboard -->
        <div class="stats-dashboard">
            <div class="stat-card">
                <div class="stat-icon">üü¢</div>
                <div class="stat-value" id="availableCount">0</div>
                <div class="stat-label">ACTIVE</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚ö´</div>
                <div class="stat-value" id="listedCount">0</div>
                <div class="stat-label">INACTIVE</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-value" id="soldCount">0</div>
                <div class="stat-label">SOLD</div>
            </div>
            <div class="stat-card profit">
                <div class="stat-icon">üìà</div>
                <div class="stat-value" id="profitValue">$0</div>
                <div class="stat-label">NET PROFIT</div>
            </div>
        </div>

        <!-- Items Grid -->
        <div class="items-grid" id="itemsGrid">
            <div class="empty-state" id="emptyState">
                <div class="pixel-art">üëæ</div>
                <h2 class="pixel-text">GAME OVER</h2>
                <p class="pixel-small">NO ITEMS IN INVENTORY</p>
                <p class="pixel-small">PRESS START TO ADD ITEMS</p>
            </div>
        </div>

        <!-- Power Button (Add Item) -->
        <button class="power-button" id="addBtn">
            <span class="pixel-text">START</span>
        </button>
    </div>

    <!-- Item Modal -->
    <div class="modal" id="itemModal">
        <div class="modal-window">
            <div class="window-header">
                <span class="pixel-text" id="modalTitle">ADD NEW ITEM</span>
                <button class="close-btn" id="closeModal" aria-label="Close modal">‚úï</button>
            </div>
            
            <form id="itemForm" class="pixel-form">
                <input type="hidden" id="itemId">
                
                <div class="form-section">
                    <label class="pixel-label" for="itemName">NAME *</label>
                    <input type="text" id="itemName" class="retro-input" required placeholder="e.g., Vintage Nike Hoodie">
                </div>

                <div class="form-row">
                    <div class="form-section half">
                        <label class="pixel-label" for="size">SIZE</label>
                        <select id="size" class="retro-select" aria-label="Select size">
                            <option value="">SELECT SIZE</option>
                            <option value="S">S - SMALL</option>
                            <option value="M">M - MEDIUM</option>
                            <option value="L">L - LARGE</option>
                            <option value="XL">XL - EXTRA LARGE</option>
                            <option value="XXL">XXL - 2X</option>
                            <option value="XXXL">XXXL - 3X</option>
                            <option value="Youth XL">YOUTH XL</option>
                        </select>
                    </div>

                    <div class="form-section half">
                        <label class="pixel-label" for="status">STATUS *</label>
                        <select id="status" class="retro-select" required aria-label="Select status">
                            <option value="Active">ACTIVE</option>
                            <option value="Inactive">INACTIVE</option>
                            <option value="SOLD">SOLD</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <label class="pixel-label">TAGS</label>
                    <div class="tags-grid">
                        <label class="tag-checkbox">
                            <input type="checkbox" name="tags" value="Hoodie">
                            <span>HOODIE</span>
                        </label>
                        <label class="tag-checkbox">
                            <input type="checkbox" name="tags" value="Jersey">
                            <span>JERSEY</span>
                        </label>
                        <label class="tag-checkbox">
                            <input type="checkbox" name="tags" value="Pullover/Jackets">
                            <span>PULLOVER/JACKETS</span>
                        </label>
                        <label class="tag-checkbox">
                            <input type="checkbox" name="tags" value="polo">
                            <span>POLO</span>
                        </label>
                        <label class="tag-checkbox">
                            <input type="checkbox" name="tags" value="T-shirts">
                            <span>T-SHIRTS</span>
                        </label>
                        <label class="tag-checkbox">
                            <input type="checkbox" name="tags" value="Bottoms">
                            <span>BOTTOMS</span>
                        </label>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-section half">
                        <label class="pixel-label" for="hangerId">HANGER ID</label>
                        <input type="text" id="hangerId" class="retro-input" placeholder="e.g., H1, L2, S3">
                    </div>

                    <div class="form-section half">
                        <label class="pixel-label" for="hangerStatus">HANGER STATUS</label>
                        <select id="hangerStatus" class="retro-select" aria-label="Select hanger status">
                            <option value="">SELECT</option>
                            <option value="Available">AVAILABLE</option>
                            <option value="In Use">IN USE</option>
                        </select>
                    </div>
                </div>

                <div class="form-divider"></div>

                <div class="form-row">
                    <div class="form-section third">
                        <label class="pixel-label" for="costPrice">COST</label>
                        <input type="number" id="costPrice" class="retro-input" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-section third">
                        <label class="pixel-label" for="sellingPrice">SELLING PRICE</label>
                        <input type="number" id="sellingPrice" class="retro-input" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-section third">
                        <label class="pixel-label" for="ebayFees">EBAY FEES</label>
                        <input type="number" id="ebayFees" class="retro-input" step="0.01" placeholder="0.00">
                    </div>
                </div>

                <div class="form-section">
                    <label class="pixel-label" for="netProfitDisplay">NET PROFIT (AUTO)</label>
                    <input type="text" id="netProfitDisplay" class="retro-input" readonly placeholder="$0.00" aria-label="Net profit calculated automatically">
                </div>

                <div class="form-section">
                    <label class="pixel-label" for="ebayUrl">EBAY LISTING URL</label>
                    <input type="url" id="ebayUrl" class="retro-input" placeholder="https://www.ebay.com/itm/...">
                </div>

                <div class="form-section">
                    <label class="pixel-label" for="dateField">DATE</label>
                    <input type="date" id="dateField" class="retro-input">
                </div>

                <div class="form-section">
                    <label class="pixel-label" for="notes">NOTES</label>
                    <textarea id="notes" class="retro-textarea" rows="3" placeholder="Additional details..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="retro-btn cancel-btn" id="cancelBtn">CANCEL</button>
                    <button type="submit" class="retro-btn save-btn">SAVE ITEM</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Item Modal -->
    <div class="modal" id="viewModal">
        <div class="modal-window">
            <div class="window-header">
                <span class="pixel-text">ITEM DETAILS</span>
                <button class="close-btn" id="closeViewModal" aria-label="Close details">‚úï</button>
            </div>

            <div class="item-details" id="itemDetails"></div>

            <div class="form-actions">
                <button class="retro-btn danger-btn" id="deleteBtn">DELETE</button>
                <button class="retro-btn save-btn" id="editBtn">EDIT</button>
            </div>
        </div>
    </div>

    <!-- Auth Modal (Sign In / Register) -->
    <div class="modal active" id="authModal">
        <div class="modal-window" style="max-width: 400px;">
            <div class="window-header">
                <span class="pixel-text">üéÆ PLAYER LOGIN üéÆ</span>
            </div>

            <form id="authForm" class="pixel-form">
                <div class="form-section">
                    <label class="pixel-label" for="authUsername">USERNAME</label>
                    <input type="text" id="authUsername" class="retro-input" required placeholder="Enter username">
                </div>

                <div class="form-section">
                    <label class="pixel-label" for="authPassword">PASSWORD</label>
                    <input type="password" id="authPassword" class="retro-input" required placeholder="Enter password">
                </div>

                <div class="form-actions">
                    <button type="button" class="retro-btn" id="registerBtn">REGISTER</button>
                    <button type="submit" class="retro-btn save-btn">LOGIN</button>
                </div>

                <div id="authError" style="color: var(--retro-red); text-align: center; margin-top: 10px; display: none;"></div>
            </form>

            <div style="text-align: center; margin-top: 20px; color: var(--retro-cyan); font-size: 12px;">
                <span id="currentUserDisplay"></span>
                <button class="retro-btn-small" id="logoutBtn" style="display: none; margin-top: 10px;">LOGOUT</button>
            </div>
        </div>
    </div>

    <!-- Modular JavaScript -->
    <script src="src/js/initial-data.js"></script>
    <script src="src/js/auth-service.js"></script>
    <script src="src/js/storage-service.js"></script>
    <script src="src/js/backup-service.js"></script>
    <script src="src/js/sort-service.js"></script>
    <script src="src/js/bulk-operations-service.js"></script>
    <script src="src/js/item-service.js"></script>
    <script src="src/js/filter-service.js"></script>
    <script src="src/js/ui-service.js"></script>
    <script src="src/js/export-service.js"></script>
    <script src="src/js/import-service.js"></script>
    <script src="src/js/app.js"></script>

    <!-- Auth System Initialization -->
    <script>
        // Initialize default user (harrisonkenned291@gmail.com with 79 items)
        AuthService.initializeDefaultUser();

        // Check if user is logged in
        if (AuthService.isLoggedIn()) {
            // Hide auth modal, show app
            document.getElementById('authModal').classList.remove('active');
            const user = AuthService.getCurrentUser();
            document.getElementById('userDisplay').textContent = `üë§ ${user.username}`;
            document.getElementById('currentUserDisplay').textContent = `Logged in as: ${user.username}`;

            // Auto-load initial data for this user if needed
            InitialDataLoader.loadInitialData();
        } else {
            // Show auth modal
            document.getElementById('authModal').classList.add('active');
        }

        // Auth form handlers
        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('authUsername').value;
            const password = document.getElementById('authPassword').value;
            const result = AuthService.login(username, password);

            if (result.success) {
                document.getElementById('authModal').classList.remove('active');
                location.reload(); // Reload to load user's items
            } else {
                const errorDiv = document.getElementById('authError');
                errorDiv.textContent = result.error;
                errorDiv.style.display = 'block';
            }
        });

        document.getElementById('registerBtn').addEventListener('click', () => {
            const username = document.getElementById('authUsername').value;
            const password = document.getElementById('authPassword').value;

            if (!username || !password) {
                const errorDiv = document.getElementById('authError');
                errorDiv.textContent = 'Please enter username and password';
                errorDiv.style.display = 'block';
                return;
            }

            const result = AuthService.register(username, password);

            if (result.success) {
                // Auto-login after register
                AuthService.login(username, password);
                document.getElementById('authModal').classList.remove('active');
                location.reload();
            } else {
                const errorDiv = document.getElementById('authError');
                errorDiv.textContent = result.error;
                errorDiv.style.display = 'block';
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            AuthService.logout();
            location.reload();
        });

        document.getElementById('headerLogoutBtn').addEventListener('click', () => {
            if (confirm('Logout? Your items are saved and will be here when you login again.')) {
                AuthService.logout();
                location.reload();
            }
        });
    </script>

    <!-- Backup Manager Modal (Riley + Alex - Sprint 5) -->
    <div class="modal" id="backupModal">
        <div class="modal-window" style="max-width: 600px;">
            <div class="window-header">
                <span class="pixel-text">üíæ BACKUP MANAGER üíæ</span>
                <button class="close-btn" id="closeBackupModal" aria-label="Close backup manager">‚úï</button>
            </div>

            <div style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <button class="retro-btn" id="createBackupBtn" style="width: 100%;">
                        üíæ CREATE BACKUP NOW
                    </button>
                </div>

                <div class="pixel-label" style="margin-bottom: 10px;">AVAILABLE BACKUPS:</div>
                <div id="backupsList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Backups will be listed here -->
                </div>

                <div id="noBackups" style="text-align: center; padding: 40px; color: var(--retro-gray); display: none;">
                    <div class="pixel-art" style="font-size: 48px;">üì¶</div>
                    <p class="pixel-small">NO BACKUPS YET</p>
                    <p style="font-size: 12px;">Create your first backup to protect your data</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for imports -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;">

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('Service Worker registered:', reg))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
